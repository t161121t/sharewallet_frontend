# 11. 未実装機能一覧

> 最終更新: 2026-02-10  
> 実装済みの内容は `10-実装状況サマリー.md` を参照してください。

---

## 実装済み / 未実装の全体マップ

```
凡例: ✅ 実装済み　⚠️ 一部未実装　❌ 未実装

[認証]
  ✅ ユーザー登録（SQLite 永続化）
  ✅ ログイン（bcrypt + JWT）
  ✅ ログアウト
  ❌ トークンリフレッシュ
  ❌ パスワードリセット
  ❌ Next.js middleware による認証ガード

[グループ]
  ✅ グループ一覧取得
  ✅ グループ詳細取得
  ❌ グループ作成
  ❌ グループ編集（名前・色）
  ❌ グループ削除
  ❌ メンバー招待 / 参加
  ❌ メンバー脱退 / 除外
  ❌ グループ権限チェック（API 側）

[支出]
  ✅ 支出登録（SQLite 永続化）
  ✅ 支出一覧取得
  ⚠️ 円グラフへのデータ反映（/expense のグラフがモックデータのまま）
  ❌ 支出編集
  ❌ 支出削除
  ❌ 支出のフィルタリング（期間・カテゴリ・メンバー別）
  ❌ 月別 / 年別集計

[割り勘・精算]
  ❌ 割り勘計算ロジック
  ❌ 精算フロー（誰が誰にいくら払うか）
  ❌ 精算画面 UI

[プロフィール]
  ✅ プロフィール取得・更新
  ❌ アバター画像の外部ストレージ保存（現在は Data URL）
  ❌ パスワード変更

[UI / UX]
  ✅ 全画面の UI 実装
  ❌ プルダウンリフレッシュ
  ❌ 無限スクロール（支出履歴）
  ❌ オフライン対応（PWA）
  ❌ プッシュ通知

[技術基盤]
  ✅ SQLite + Prisma v7
  ✅ JWT 認証（jose）
  ❌ リクエストバリデーション（Zod）
  ❌ テスト（Vitest）
  ❌ CI / CD
  ❌ 本番デプロイ設定
```

---

## 優先度別 未実装機能

### 優先度: 高（コア機能に直結）

| # | 機能 | 種別 | 概要 | 関連ファイル |
|---|------|------|------|-------------|
| 1 | 円グラフへの実データ反映 | バグ修正 | `/expense` の `ExpensePieChart` がモックデータを表示中。`getExpenses()` で取得した支出をカテゴリ別に集計してグラフに渡す必要がある | `src/app/expense/page.tsx`, `src/components/ui/ExpensePieChart.tsx` |
| 2 | グループ作成 | 新機能 | 新しいグループを作成する API + UI。グループ名・テーマカラーを入力して登録 | API: `POST /api/groups`, UI: 新規画面 or モーダル |
| 3 | 支出の編集・削除 | 新機能 | 登録済みの支出を修正・取り消しできるようにする | API: `PUT/DELETE /api/groups/:groupId/expenses/:expenseId` |
| 4 | グループへのメンバー招待 | 新機能 | 既存ユーザーをグループに招待し、参加できるフローを実装 | API: `POST /api/groups/:groupId/members`, 招待コード or メール |
| 5 | 割り勘計算 | 新機能 | グループ内の支出を元に、メンバー間の精算額を自動計算する | 計算ロジック + 精算画面 |

### 優先度: 中（品質・安全性の向上）

| # | 機能 | 種別 | 概要 | 関連ファイル |
|---|------|------|------|-------------|
| 6 | Next.js middleware 認証ガード | 改善 | 各 API ルートで個別に認証チェックしている現状を、`middleware.ts` に集約して保護ルートを一括管理 | `src/middleware.ts`（新規） |
| 7 | グループメンバー権限チェック | 改善 | 所属していないグループへの支出登録やデータ取得を API 側で防ぐ | 各 API ルート |
| 8 | リクエストバリデーション（Zod） | 改善 | API への入力を厳密に検証。不正なカテゴリ名・負の金額・空文字列などを拒否 | 各 API ルート |
| 9 | トークンリフレッシュ | 改善 | JWT 有効期限（現在 7 日）を短縮し、リフレッシュトークンで自動更新する仕組み | `src/lib/auth.ts`, `src/lib/apiClient.ts` |
| 10 | Prisma エラーハンドリング | 改善 | `P2002`（ユニーク制約違反）等の Prisma 例外を統一的に処理し、ユーザーに分かりやすいエラーを返す | 各 API ルート |
| 11 | グループ編集・削除 | 新機能 | グループ名・テーマカラーの変更、グループの削除 | API: `PUT/DELETE /api/groups/:groupId` |
| 12 | メンバー脱退・除外 | 新機能 | グループからメンバーが脱退、またはオーナーがメンバーを除外する | API: `DELETE /api/groups/:groupId/members/:userId` |

### 優先度: 低（将来的な改善）

| # | 機能 | 種別 | 概要 |
|---|------|------|------|
| 13 | テスト（Vitest） | 技術基盤 | API ルートのユニットテスト、コンポーネントのテスト。テスト用 SQLite を使用 |
| 14 | CI / CD | 技術基盤 | GitHub Actions 等でリント・テスト・ビルドの自動化 |
| 15 | パスワード変更 | 新機能 | プロフィール画面から現在のパスワード + 新パスワードで変更 |
| 16 | パスワードリセット | 新機能 | メールアドレスによるパスワードリセットフロー |
| 17 | アバター画像の外部保存 | 改善 | 現在は Data URL で SQLite に直接保存。S3 / Cloudflare R2 等に保存して URL を参照する形に変更 |
| 18 | 支出フィルタリング | 新機能 | 期間（今月・先月・カスタム）、カテゴリ、メンバーで支出を絞り込み |
| 19 | 月別・年別集計 | 新機能 | 月ごと・年ごとの支出合計やカテゴリ内訳を表示 |
| 20 | BudgetDonutChart の実データ化 | バグ修正 | `src/components/ui/BudgetDonutChart.tsx` が `DUMMY_DATA` を使用中 |
| 21 | プルダウンリフレッシュ | UX 改善 | 画面を下に引っ張ってデータを再取得 |
| 22 | 無限スクロール | UX 改善 | 支出履歴の一覧を無限スクロールでページング |
| 23 | PWA 対応 | UX 改善 | Service Worker + マニフェストでオフライン対応・ホーム画面追加 |
| 24 | プッシュ通知 | UX 改善 | 新しい支出登録時やグループ招待時の通知 |
| 25 | 本番デプロイ設定 | 技術基盤 | Vercel / Fly.io 等へのデプロイ設定、環境変数管理、DB マイグレーション |

---

## 未実装 API エンドポイント一覧

現在の API は `07-API仕様書.md` を参照。以下は今後追加が必要なエンドポイント。

| メソッド | パス | 認証 | 概要 | 優先度 |
|----------|------|------|------|--------|
| POST | `/api/groups` | 必要 | グループ作成 | 高 |
| PUT | `/api/groups/:groupId` | 必要 | グループ編集 | 中 |
| DELETE | `/api/groups/:groupId` | 必要 | グループ削除 | 中 |
| POST | `/api/groups/:groupId/members` | 必要 | メンバー招待・追加 | 高 |
| DELETE | `/api/groups/:groupId/members/:userId` | 必要 | メンバー脱退・除外 | 中 |
| PUT | `/api/groups/:groupId/expenses/:expenseId` | 必要 | 支出編集 | 高 |
| DELETE | `/api/groups/:groupId/expenses/:expenseId` | 必要 | 支出削除 | 高 |
| GET | `/api/groups/:groupId/settlement` | 必要 | 割り勘計算結果 | 高 |
| PUT | `/api/users/me/password` | 必要 | パスワード変更 | 低 |
| POST | `/api/auth/refresh` | 不要 | トークンリフレッシュ | 中 |
| POST | `/api/auth/reset-password` | 不要 | パスワードリセット | 低 |

---

## DB スキーマ変更が必要な機能

現在のスキーマ（`prisma/schema.prisma`）は 4 モデル: `User`, `Group`, `GroupMember`, `Expense`。

| 機能 | 必要なスキーマ変更 |
|------|-------------------|
| グループ削除 | `Expense`, `GroupMember` にカスケード削除を追加 |
| メンバー招待 | 招待コード用テーブル `GroupInvite`（`id`, `groupId`, `code`, `expiresAt`）を追加、または既存テーブルで対応 |
| 精算 | 精算記録テーブル `Settlement`（`id`, `groupId`, `fromUserId`, `toUserId`, `amount`, `settledAt`）を追加 |
| パスワードリセット | リセットトークンテーブル `PasswordReset`（`id`, `userId`, `token`, `expiresAt`）を追加 |

---

## 推奨実装順序

```
Phase 3（コア機能の拡充）
  ├── #1  円グラフへの実データ反映（バグ修正・即対応可能）
  ├── #20 BudgetDonutChart の実データ化（同上）
  ├── #3  支出の編集・削除
  ├── #2  グループ作成
  └── #4  メンバー招待

Phase 4（割り勘・品質改善）
  ├── #5  割り勘計算・精算
  ├── #6  middleware 認証ガード
  ├── #7  グループメンバー権限チェック
  ├── #8  リクエストバリデーション（Zod）
  └── #10 Prisma エラーハンドリング

Phase 5（運用・拡張）
  ├── #9  トークンリフレッシュ
  ├── #11 グループ編集・削除
  ├── #12 メンバー脱退・除外
  ├── #13 テスト（Vitest）
  ├── #14 CI / CD
  └── #25 本番デプロイ設定

Phase 6（UX・追加機能）
  ├── #15 パスワード変更
  ├── #18 支出フィルタリング
  ├── #19 月別・年別集計
  └── #17 アバター画像の外部保存
```

---

## 注意事項

- `#1`（円グラフ）と `#20`（ドーナツチャート）はコード上のモックデータ残りであり、即座に修正可能
- グループ作成（`#2`）とメンバー招待（`#4`）は、アプリとして「複数人で使う」ために必須の機能
- 割り勘（`#5`）は ShareWallet のコアバリューであり、Phase 4 の最優先で取り組むことを推奨
