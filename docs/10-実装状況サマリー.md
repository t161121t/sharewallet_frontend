# 10. ShareWallet 実装状況サマリー

## 全体像

```
[ブラウザ] → [Next.js ページ (React)] → [apiClient.ts] → [API Route] → [Prisma] → [SQLite]
```

---

## 完了した実装

### 1. フロントエンド UI

全画面の UI が実装済み。

| 画面 | パス | 内容 |
|---|---|---|
| スプラッシュ | `/` | ロゴアニメーション → `/home` に自動リダイレクト |
| ホーム | `/home` | ログイン・新規登録ボタン |
| ログイン | `/login` | メール・パスワードフォーム |
| 新規登録 | `/register` | 名前・メール・パスワードフォーム |
| ダッシュボード | `/dashboard` | グループ選択画面 |
| 支出入力 | `/expense` | カテゴリ・金額入力 + 円グラフ |
| 支出履歴 | `/expense/history` | 日付別の支出一覧 + サマリーカード |
| プロフィール | `/profile` | アバター・名前・メール編集 + ログアウト |

UI コンポーネント:
- `BottomNav` — 下部ナビゲーションバー
- `GroupBanner` — グループ情報バナー
- `ExpensePieChart` — 支出円グラフ（recharts）
- `GenreSelect` — カテゴリ選択ドロップダウン
- `PrimaryButton` — ローディング対応のボタン
- `TextInput` — バリデーション対応の入力フィールド
- `PageTransition` — 画面遷移アニメーション（framer-motion）
- `Logo` / `ShareWalletLogo` / `HeartWalletLogo` — ロゴコンポーネント
- `CoinIcon` — アニメーション付きコインアイコン
- `CategoryIcon` — カテゴリ別アイコン（貯金・住居・交通・食費・娯楽・その他）

### 2. API 層

フロントエンドと DB の間に API 層を導入済み。

**API クライアント (`src/lib/apiClient.ts`):**
- トークン管理（localStorage）
- 認証ヘッダーの自動付与
- 全 API 呼び出し関数

**API エンドポイント:**

| メソッド | パス | 認証 | 内容 |
|---|---|---|---|
| POST | `/api/auth/login` | 不要 | ログイン（JWT 発行） |
| POST | `/api/auth/register` | 不要 | 新規登録 |
| GET | `/api/users/me` | 必要 | プロフィール取得 |
| PUT | `/api/users/me` | 必要 | プロフィール更新 |
| GET | `/api/groups` | 必要 | グループ一覧取得 |
| GET | `/api/groups/:groupId` | 必要 | グループ詳細取得 |
| GET | `/api/groups/:groupId/expenses` | 必要 | 支出一覧取得 |
| POST | `/api/groups/:groupId/expenses` | 必要 | 支出登録 |

### 3. データベース（SQLite + Prisma v7）

4 テーブルで構成。

```
users ──┬── 1:N ── expenses
        │
        └── M:N ── groups（group_members 経由）
                     │
                     └── 1:N ── expenses
```

| テーブル | 主なカラム |
|---|---|
| `users` | id, name, email, password_hash, color, avatar_url |
| `groups` | id, name, color |
| `group_members` | id, user_id, group_id（複合ユニーク） |
| `expenses` | id, group_id, member_id, category, amount, memo, date |

**シードデータ:** 6ユーザー、3グループ、10支出レコード（初期パスワード: `password123`）

### 4. 認証

| 要素 | 実装内容 |
|---|---|
| パスワード保存 | bcryptjs でハッシュ化して SQLite に保存 |
| トークン発行 | jose で JWT を生成（HS256、有効期限 7 日） |
| トークン検証 | JWT をデコード・署名検証 + 有効期限チェック |
| ユーザー特定 | JWT payload の `sub` からユーザー ID を取得 |

### 5. ドキュメント

| ファイル | 内容 |
|---|---|
| `docs/01-Phase1全体ガイド.md` | Phase 1 実装の全体ガイド（Step 1〜4） |
| `docs/02-CoinIcon実装手順.md` | CoinIcon コンポーネントの実装手順 |
| `docs/03-HeartWalletLogo実装手順.md` | HeartWalletLogo コンポーネントの実装手順 |
| `docs/04-ホーム画面実装手順.md` | ホーム画面の実装手順 |
| `docs/05-ログイン画面実装手順.md` | ログイン画面の実装手順 |
| `docs/06-Phase2実装計画.md` | Phase 2 以降の実装計画 |
| `docs/07-API仕様書.md` | API 仕様書（全エンドポイントのリクエスト/レスポンス例） |
| `docs/08-SQLite移管計画.md` | SQLite 移管の計画書（思考プロセス + 実装手順） |
| `docs/09-SQLiteコードレビュー.md` | SQLite 移管のコードレビュー |
| `docs/11-未実装機能一覧.md` | 未実装機能の一覧・優先度・推奨実装順序 |
| `docs/12-グループ作成-実装手順.md` | グループ作成機能の5段階実装手順 |
| `docs/13-支出編集削除-実装手順.md` | 支出の編集・削除機能の5段階実装手順 |

---

## できること

- ユーザー登録（SQLite に保存）
- ログイン（パスワード照合 + JWT 発行）
- グループ一覧の表示（自分が所属するグループのみ）
- グループ詳細の表示（メンバー一覧付き）
- 支出の登録（SQLite に永続化）
- 支出履歴の閲覧（日付別グルーピング + サマリー）
- プロフィールの更新（名前、メール、アバター色、アバター画像）
- ログアウト

---

## 未実装（今後の開発候補）

### 機能

| 機能 | 内容 |
|---|---|
| グループの作成・編集・削除 | API + UI が未実装 |
| グループへのメンバー招待 | 招待フロー全体が未実装 |
| 支出の編集・削除 | API + UI が未実装 |
| 割り勘計算・精算 | ユーザー間の貸し借り計算ロジックが未実装 |

### 技術的改善

| 項目 | 内容 |
|---|---|
| リクエストバリデーション | Zod 等による入力検証（不正なカテゴリ名などを防ぐ） |
| グループメンバー権限チェック | 所属していないグループへの支出登録を防ぐ |
| トークンリフレッシュ | 現在は 7 日で期限切れ。リフレッシュ機構が必要 |
| エラーハンドリング | Prisma 例外（P2002 等）の統一的な処理 |
| テスト | Vitest + テスト用 SQLite での API テスト |
| 画像保存 | Data URL → S3 / R2 等の外部ストレージ |

---

## 技術スタック

| カテゴリ | 技術 |
|---|---|
| フレームワーク | Next.js 15.5.4（App Router） |
| 言語 | TypeScript 5 |
| UI | React 19 + Tailwind CSS 4 |
| アニメーション | framer-motion |
| チャート | recharts |
| 通知 | react-hot-toast |
| ORM | Prisma v7 |
| DB | SQLite（@prisma/adapter-better-sqlite3） |
| 認証 | bcryptjs（パスワード） + jose（JWT） |
